# Ø§ÛŒÙ† Workflow Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± ØªØºÛŒÛŒØ±Ø§Øª Ø¯Ø± Ù¾ÙˆØ´Ù‡ viraaiio/docs Ø±Ø§ Ø§Ø² Ù…Ø®Ø²Ù† docs
# Ø¨Ù‡ Ù…Ø®Ø²Ù† Ø®ØµÙˆØµÛŒ viraai-cloud-project Ø³ÛŒÙ†Ú© (Push) Ù…ÛŒâ€ŒÚ©Ù†Ø¯.

name: Document Sync to Cloud Project

on:
  push:
    branches:
      - main # **Ø­ØªÙ…Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯: Ø§Ú¯Ø± Ø¨Ø±Ù†Ú† Ø§ØµÙ„ÛŒ Ø´Ù…Ø§ master Ø§Ø³ØªØŒ Ø¢Ù† Ø±Ø§ Ø¨Ù‡ master ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯.**
    paths:
      - 'viraaiio/docs/**' # ÙÙ‚Ø· Ø¯Ø± ØµÙˆØ±Øª ØªØºÛŒÛŒØ± Ø¯Ø± Ø§ÛŒÙ† Ù…Ø³ÛŒØ± ÙØ¹Ø§Ù„ Ø´ÙˆØ¯

jobs:
  sync_docs:
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout Ù…Ø®Ø²Ù† Ø§ØµÙ„ÛŒ (docs) Ú©Ù‡ ØªØ±ÛŒÚ¯Ø± Ø´Ø¯Ù‡ Ø§Ø³Øª
      - name: Checkout Source Repository (viraaiio/docs)
        uses: actions/checkout@v4
        with:
          path: source_repo
          # ØªÙˆØ¬Ù‡: Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ø§Ø² ØªÙˆÚ©Ù† Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ú©Ù‡ Ø¨Ø±Ø§ÛŒ Ù…Ø®Ø²Ù† ÙØ¹Ù„ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯Ø§Ø±Ø¯

      # 2. Checkout Ù…Ø®Ø²Ù† Ù…Ù‚ØµØ¯ (cloud-project)
      - name: Checkout Target Repository (viraai-cloud-project)
        uses: actions/checkout@v4
        with:
          repository: viraaiio/viraai-cloud-project
          ref: master # Ø¨Ø±Ù†Ú† Ù…Ù‚ØµØ¯ (Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØµÙˆÛŒØ±ØŒ master Ø§Ø³Øª)
          path: target_repo
          # *** Ø§ÛŒÙ† Ø®Ø· Ø­ÛŒØ§ØªÛŒ Ø§Ø³Øª Ùˆ Ù…Ø´Ú©Ù„ Ø´Ù…Ø§ Ø±Ø§ Ø­Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ ***
          token: ${{ secrets.PAT_TOKEN }}

      # 3. Ú©Ù¾ÛŒ Ùˆ Ø³ÛŒÙ†Ú© ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
      - name: Copy & Sync files from Docs to Cloud Project Subdir
        run: |
          # Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø§ÛŒØ±Ú©ØªÙˆØ±ÛŒ Ù…Ù‚ØµØ¯ Ø¯Ø± Ù…Ø®Ø²Ù† target
          mkdir -p target_repo/viraai/docs

          # Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† ØªÙ…Ø§Ù… Ù…Ø­ØªÙˆÛŒØ§Øª Ù¾ÙˆØ´Ù‡ docs Ø§Ø² source Ø¨Ù‡ target
          rsync -av --exclude='.git' source_repo/viraaiio/docs/ target_repo/viraai/docs/

      # 4. ØªÙ†Ø¸ÛŒÙ…Ø§Øª Git Ø¨Ø±Ø§ÛŒ Push Ø®ÙˆØ¯Ú©Ø§Ø±
      - name: Configure Git for Auto-Commit
        run: |
          git config --global user.email "actions@github.com"
          git config --global user.name "GitHub Actions Bot"

      # 5. Commit Ùˆ Push ØªØºÛŒÛŒØ±Ø§Øª Ø¨Ù‡ Ù…Ø®Ø²Ù† Ù…Ù‚ØµØ¯
      - name: Commit and Push Changes to Target Repo
        run: |
          cd target_repo
          git add .

          # Ø¨Ø±Ø±Ø³ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ø¢ÛŒØ§ ØªØºÛŒÛŒØ±ÛŒ Ø¨Ø±Ø§ÛŒ Commit ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ ÛŒØ§ Ù†Ù‡
          if git diff --cached --exit-code; then
            echo "No changes to commit. Skipping push."
          else
            git commit -m "ğŸ¤– [Docs Sync] Automatic documentation update from viraaiio/docs"

            # Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ØªÙˆÚ©Ù† PAT Ø¨Ø±Ø§ÛŒ Push:
            # ØªÙˆÚ©Ù† Ø±Ø§ Ø¯Ø± URL Ù‚Ø±Ø§Ø± Ù…ÛŒâ€ŒØ¯Ù‡ÛŒÙ… ØªØ§ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…Ø®Ø²Ù† Ø®ØµÙˆØµÛŒ Ù…Ù‚ØµØ¯ Ø±Ø§ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯.
            git push https://${{ secrets.PAT_TOKEN }}@github.com/viraaiio/viraai-cloud-project.git HEAD:master
          fi
