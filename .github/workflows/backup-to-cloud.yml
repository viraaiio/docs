name: Automatic Backup of Documentation

# این ورک‌فلو با هر push به master که شامل تغییر در پوشه viraai/docs باشد، اجرا می‌شود.
# همچنین امکان اجرای دستی از تب Actions را فراهم می‌کند.
on:
  push:
    branches:
      - master
    paths:
      - 'viraai/docs/**'
  workflow_dispatch:

jobs:
  backup:
    runs-on: ubuntu-latest
    steps:
      # ۱. Checkout کردن محتوای مخزن فعلی
      - name: Checkout Source Repository
        uses: actions/checkout@v4
        with:
          # اطمینان حاصل شود که تاریخچه کامل برای push بعدی وجود دارد
          fetch-depth: 0

      # ۲. کپی کردن محتوای پوشه viraai/docs به یک دایرکتوری موقت
      # این کار محتوای docs را برای Push آماده می‌کند تا در ریشه مخزن مقصد قرار گیرد.
      - name: Copy Docs Content to Temporary Directory
        run: |
          # ساخت دایرکتوری مقصد
          mkdir -p /tmp/docs_to_push

          # کپی کردن محتوای *داخل* viraai/docs (فایل‌ها و زیرپوشه‌ها) به دایرکتوری موقت
          # از cp برای اطمینان از کپی کامل استفاده می‌شود.
          cp -R viraai/docs/. /tmp/docs_to_push

      # ۳. Push کردن دایرکتوری موقت به مخزن viraaiio/viraai-backup
      - name: Push to Destination Repository (ad-m/github-push-action)
        uses: ad-m/github-push-action@master
        with:
          # توکنی که برای دسترسی به مخزن viraai-backup استفاده می‌شود
          github_token: ${{ secrets.PAT_TOKEN }}
          # شاخه مقصد
          branch: master
          # مسیر دایرکتوری که محتوای آن باید push شود
          directory: /tmp/docs_to_push
          # آدرس کامل مخزن مقصد
          repository: viraaiio/viraai-backup
          # پیام کامیت
          commit_message: "Automated backup of documentation [skip ci]"
          # force: true برای اطمینان از اینکه همیشه محتوا overwrite شود
          force: true

      # ۴. مرحله تایید نهایی
      - name: Verification Log
        if: success()
        run: echo "Backup completed successfully to viraaiio/viraai-backup"
